/*! Yin and Yang Core Framework v0.3.7 | Copyright (c) 2015-2016 Ivan (3axap4eHko) Zakharchenko*/
"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var t=0,r=Array(n.length);t<n.length;t++)r[t]=n[t];return r}return Array.from(n)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol?"symbol":typeof n},isNode="object"!==("undefined"==typeof window?"undefined":_typeof(window));!function(n,t){function r(n,t,r){r=r||{},c(n)||c(n,{});var e=c(n);return e.hasOwnProperty(t)||(e[t]=r),e[t]}function e(n,t){var r=n.charCodeAt(0),e=t.charCodeAt(0);return new Array(e-r+1).fill(r).map(function(n,t){return String.fromCharCode(n+t)})}function u(n,t,r){return Object.keys(t).forEach(function(e){f.isStructure(n[e])&&f.isStructure(t[e])?u(n[e],t[e],r):n[e]=t[e]}),n}function o(){return Math.floor(4096+4095*Math.random()).toString(16)}function i(){return("0000"+Date.now().toString("16")).slice(-12)}function a(n,t){return r(n,d)[t]=r(n,d)[t]||[]}var f={DEBUG:0,get isNode(){return isNode}};f.dbg=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];t.forEach(function(n){console.log(n)}),isNode&&process.exit(0)},f.dmp=function(n,t){return console.log(t+": "+n),n},f.watch=function(n){var t=new Date;return n(),(new Date).getTime()-t.getTime()},f.test=function(t,r){return n.watch(function(){for(;t--;)r(t)})},f.p=function(){var n=new WeakMap;return function(t,r,e){if(2===arguments.length)return n.set(t,r);if(1===arguments.length)return n.get(t);if(3===arguments.length&&e)return n.remove(t);throw new Error("Private scope storage called with wrong count of arguments: "+arguments.length)}};var c=f.p();f.classOf=function(n){return Object.prototype.toString.call(n).slice(8,-1)},f.is=function(n,t){return f.classOf(n)==t.name},f.isArray=function(n){return f.is(n,Array)},f.isNumber=function(n){return f.is(n,Number)},f.isInteger=function(n){return Number.isInteger(n)},f.isFiniteNumber=function(n){return f.isNumber(n)&&isFinite(n)},f.isDate=function(n){return f.is(n,Date)},f.isString=function(n){return f.is(n,String)},f.isNotEmptyString=function(n){return f.isString(n)&&n.length>0},f.isObject=function(n){return f.is(n,Object)},f.isFunction=function(n){return f.is(n,Function)},f.isBoolean=function(n){return f.is(n,Boolean)},f.isDefined=function(n){return"undefined"!=typeof n},f.isNull=function(n){return null===n},f.isValue=function(n){return f.isDefined(n)&&!f.isNull(n)},f.isStructure=function(n){return f.isObject(n)||f.isArray(n)},f.isIterated=function(n){return f.isObject(n)||f.isArray(n)||f.isString(n)},f.isKeyValue=function(n){return f.isObject(n)&&n.hasOwnProperty("key")&&n.hasOwnProperty("value")},f.areEqual=function(n,r){if(null===n||n===t||null===r||r===t)return n===r;if(n.constructor!==r.constructor)return!1;if(n instanceof Function)return n===r;if(n instanceof RegExp)return n===r;if(n===r||n.valueOf()===r.valueOf())return!0;if(Array.isArray(n)&&n.length!==r.length)return!1;if(n instanceof Date)return!1;if(!(n instanceof Object))return!1;if(!(r instanceof Object))return!1;var e=f.keys(n);return f.keys(r).every(function(n){return-1!==e.indexOf(n)})&&e.every(function(t){return f.areEqual(n[t],r[t])})},f.toInt=function(n){return isFinite(n=parseInt(n))?n:0},f.toIntOrDefault=function(n,t){return isFinite(n=parseInt(n))?n:t||0},f.toFloat=function(n){return isFinite(n=parseFloat(n))?n:0},f.toFloatOrDefault=function(n,t){return isFinite(n=parseFloat(n))?n:t||0},f.toArray=Array.from,f.toArrayOf=Array.of,f.toKeyValue=function(n,t){return{key:n,value:t}},f.toKeyValueOf=function(n,t){return{key:t,value:n[t]}},f.toString=function(n){return f.isValue(n)?n.toString():""},f.toJsonString=function(n){return JSON.stringify(n)},f.toJsonObject=function(n){return JSON.parse(n)},f.toCharCodes=function(n){return f.toArray(n.toString()).map(function(n){return n.charCodeAt(0)})},f.toHex=function(n){return(f.isNumber(n)?[n]:f.toCharCodes(n)).map(function(n){return n.toString(16)}).join("")},f.toHexArray=function(n){return f.toArray(n).map(f.toHex)},f.toHexFormat=function(n){return f.toHexArray(n).map(function(n,t){return n+(++t%8?"":"\n")}).join(" ")},f.toNibbles=function(n){return f.toHex(n).split("")},f.to4Bit=function(n){return("000"+parseInt(n).toString(2)).slice(-4)},f.to4BitFromHex=function(n){return f.to4Bit(parseInt(n,16))},f.to8Bit=function(n){return("0000000"+parseInt(n).toString(2)).slice(-8)},f.to8BitFromHex=function(n){return f.to8Bit(parseInt(n,16))};var s=e("0","9").concat(e("A","Z"),e("a","z"),["!","#","$","%","&","(",")","*","+","-",";","<","=",">","?","@","^","_","`","{","|","}","~"]);f.toBase=function(n,t,r){r=r||s,t=f.toInt(t),n=f.toHex(n);var e=Math.ceil(Math.log2(t)),u=n.split("").map(f.to4BitFromHex).join("").split("");return f.groupOf(u,e).map(function(n){return parseInt(n.join(""),2)}).map(function(n){return r[n%t]})};var l=/^(\w+):\/\/(.*?)\/(.*)$/;f.urlParse=function(n){var t=n.match(l);return t?{schema:t[1],host:t[2],href:t[3],hash:t[3].split("#")[1],query:t[3].split("?")[1]}:{}},f.apply=function(n,r){return n.apply(t,_toConsumableArray(r))},f.call=function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;t>e;e++)r[e-1]=arguments[e];return n(r)},f.curry=function(n){for(var r=arguments.length,e=Array(r>1?r-1:0),u=1;r>u;u++)e[u-1]=arguments[u];return function(){for(var r=arguments.length,u=Array(r),o=0;r>o;o++)u[o]=arguments[o];return n.apply(t,e.concat(u))}},f.curryRight=function(n){for(var r=arguments.length,e=Array(r>1?r-1:0),u=1;r>u;u++)e[u-1]=arguments[u];return function(){for(var r=arguments.length,u=Array(r),o=0;r>o;o++)u[o]=arguments[o];return n.apply(t,u.concat(e))}},f.create=function(n,t){return new(n=Function.prototype.bind.apply(n,[null].concat(t)))},f.factory=function(n){return function(){for(var t=arguments.length,r=Array(t),e=0;t>e;e++)r[e]=arguments[e];return f.create(n,r)}},f.defineValue=function(n,t,r){return Object.defineProperty(n,t,{writable:!0,enumerable:!1,configurable:!1,value:r})},f.defineGetter=function(n,t,r){return Object.defineProperty(n,t,{enumerable:!1,configurable:!1,get:r})},f.defineSetter=function(n,t,r){return Object.defineProperty(n,t,{enumerable:!1,configurable:!1,set:r})},f.defineGetterSetter=function(n,t,r,e){return Object.defineProperty(n,t,{enumerable:!1,configurable:!1,get:r,set:e})},f.range=function(n,t){return new Array(n).fill(t)},f.keys=function(n){return f.isFiniteNumber(n)?f.range(n,0):f.isObject(n)?Object.keys(n):Object.keys(n).map(f.toInt)},f.values=function(n){return Object.keys(n).map(function(t){return n[t]})},f.pairs=function(n){return f.keys(n).map(function(t){return f.toKeyValueOf(n,t)})},f.each=function(n,t){return f.keys(n).forEach(function(r){return t(n[r],r,n)})},f.every=function(n,t){return f.keys(n).every(function(r){return t(n[r],r,n)})},f.any=f.some=function(n,t){return f.keys(n).some(function(r){return t(n[r],r,n)})},f.merge=function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;t>e;e++)r[e-1]=arguments[e];if(!f.isValue(n))throw new TypeError("Cannot convert target to object");return r.filter(f.isStructure).forEach(function(t){return u(n,t,new WeakMap)}),n},f.clone=function(n){return f.isStructure(n)?u(f.isArray(n)?[]:{},n,[]):n},f.freeze=function(n){for(var t,r=arguments.length,e=Array(r>1?r-1:0),u=1;r>u;u++)e[u-1]=arguments[u];return Object.freeze((t=Object).assign.apply(t,[n].concat(e)))},f.repeat=function(n,t){for(var r=0;n>r;)t(r++,n)},f.repeatHandled=function(n,t,r){for(var e=0;n>e;)r(t(e++,n))},f.map=function(n,t){return f.isObject(n)?f.keys(n).reduce(function(r,e){return r[e]=t(n[e],e,n),r},{}):f.isString(n)?f.toArray(n).map(t).join(""):f.toArray(n).map(t)},f.reduce=function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),u=2;r>u;u++)e[u-2]=arguments[u];var o=f.keys(n),i=f.values(n);return e.unshift(function(r,e,u){return t(r,e,o[u],n)}),i.reduce.apply(i,e)},f.groupOf=function(n,t){var r=f.pairs(n),e=r.length-1,u=r.reduceRight(function(n,r,u){return(e-u)%t?n[0].unshift(r):n.unshift([r]),n},[]);return f.isObject(n)?u.map(function(n){return n.reduce(function(n,t){return n[t.key]=t.value,n},{})}):(u=u.map(function(n){return n.map(function(n){return n.value})}),f.isString(n)&&(u=u.map(function(n){return n.join("")})),u)},f.filter=function(n,t){var r=f.keys(n).reduce(function(r,e){return t(n[e],e,n)&&(r[e]=n[e]),r},f.isObject(n)?{}:[]);return f.isString(r)&&(r=r.join("")),r},f.first=function(n,t,r){var e=f.keys(n).find(function(r){return t(n[r],r,n)});return f.isDefined(e)||(e=r),f.toKeyValueOf(n,e)},f.last=function(n,t,r){var e=f.keys(n).reduce(function(r,e){return t(n[e],e,n)&&(r=e),r},r);return f.isKeyValue(e)?e:f.toKeyValueOf(n,e)},f.lastReduce=function(n,t){var r=f.keys(n),e=r.reduce(function(r,e){return t(n[r],n[e],e,n)?e:r});return f.toKeyValueOf(n,e)},f.take=function(n,t){var r=f.first(n,t);return f.isObject(n)?delete n[r.key]:f.isArray(n)&&n.splice(r.key,1),r},f.takeReduce=function(n,t){var r=f.keys(n),e=r.reduce(function(r,e){var u=n[r],o=n[e];return t(u,o,r,n)===o?e:r}),u=f.toKeyValueOf(n,e);return f.isArray(n)?n.splice(u.key,1):delete n[u.key],u},f.sum=function(n){return f.values(n).reduce(function(n,t){return n+t},f.isString(n)?"":0)},f.max=function(n){return f.toKeyValueOf(n,f.keys(n).reduce(function(t,r){return n[t]>=n[r]?t:r}))},f.min=function(n){return f.toKeyValueOf(n,f.keys(n).reduce(function(t,r){return n[t]<=n[r]?t:r}))},f.countOf=function(n,t){return f.keys(n).reduce(function(r,e){return t(n[e],e,n)?r+1:r},0)},f.random=function(n,r){return n===t?Math.random():(r===t&&(r=n,n=0),n+Math.floor(Math.random()*(r-n+1)))},f.randomBool=function(){return Math.random()>.5},f.randomString=function(n){return f.range(n,"").map(function(n){return String.fromCharCode(f.random(n=f.randomBool()?65:97,n+25))}).join("")},f.randomCase=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];var e=f.random(100),u=0;return f.first(t,function(n){return u+n>e?!0:void(u+=n)},t.length-1).key},f.randomGUID=function(){return o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+i()},f.shuffle=function(n){for(var t=f.values(n),r=[];t.length;)r.push(t.splice(f.random(t.length),1)[0]);return r},f.fnArgsCallFn=function(n){return function(){for(var t=arguments.length,r=Array(t),e=0;t>e;e++)r[e]=arguments[e];return n(r)}},f.fnArgsApplyFn=function(n){return function(r){return n.apply(t,_toConsumableArray(r))}},f.fnArgsValue=function(n,t){return t(n),n},f.fnEmpty=function(){},f.fnTrue=function(){return!0},f.fnFalse=function(){return!1},f.fnArgs=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return t},f.fnArg=function(n){return n},f.fnCallback=function(n){return function(t){return n(t)}},f.fnLog=function(){var n;return(n=console).log.apply(n,arguments)},f.fnPromise=function(n){return new Promise(n)},f.fnPromises=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return Promise.all(t.map(f.fnPromise))},f.stringToUpperCaseFirst=function(n){return n.charAt(0).toUpperCase()+n.substr(1).toLowerCase()},f.stringToPascalCase=function(n,t){return n.split(/[\s\-_\.,]+/g).map(f.stringToUpperCaseFirst).join(t||"")},f.stringToCamelCase=function(n){return(n=f.stringToPascalCase(n)).charAt(0).toLowerCase()+n.substr(1)},f.stringToCapitalize=function(n){return n.toUpperCase()},f.stringOccurrence=function(n,t){return(n.match(new RegExp(t,"g"))||[]).length},f.stringPadLeft=function(n,t,r){return new Array(t).fill(r||" ").join("").concat(n).slice(-t)},f.stringPadRight=function(n,t,r){return n.concat(new Array(t).fill(r||" ").join("")).slice(0,t)},f.fmtString=function(n){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;t>e;e++)r[e-1]=arguments[e];var u=n.toString();return 1==r.length&&f.isStructure(r[0])&&(r=r[0]),f.each(r,function(n,t){var r=new RegExp("\\{"+t+"\\}","g");u=u.replace(r,n)}),u};var g="000000000000000";f.fmtNumber=function(n,t,r){n=f.toInt(n),t=f.toInt(t);var e=Math.abs(n)+"",u=e.length;return e=t>u?(g+e).slice(-t):e,0>n?e="-"+e:r&&n>0&&(e="+"+e),e};var m={Y:function(n){return n.getFullYear()},y:function(n){return n.getFullYear()%100},M:function(n){return f.fmtNumber(n.getMonth()+1,2)},D:function(n){return f.fmtNumber(n.getDate(),2)},W:function(n){return f.fmtNumber(n.getDay(),2)},h:function(n){return f.fmtNumber(n.getHours(),2)},m:function(n){return f.fmtNumber(n.getMinutes(),2)},s:function(n){return f.fmtNumber(n.getSeconds(),2)},u:function(n){return n.getMilliseconds()},z:function(n){return n.getTimezoneOffset()},Z:function(n){var t=n.getTimezoneOffset()/60;return t?f.fmtNumber(0|t,2,!0)+":"+f.fmtNumber(Math.abs(t)%1*60,2):"Z"}};f.fmtDate=function(n,t){return f.toArray(t).map(function(t){return m[t]?m[t](n):t}).join("")},f.fmtDate.DATE_W3C="Y-M-DTh:m:sZ:00",f.fmtDate.DATE_XSD="Y-M-DTh:m:sZ",f.dateAddYears=function(n,t){return f.fnArgsValue(new Date(n),function(n){return n.setFullYear(n.getFullYear()+t)})},f.dateAddMonths=function(n,t){return f.fnArgsValue(new Date(n),function(n){return n.setMonth(n.getMonth()+t)})},f.dateAddDays=function(n,t){return f.fnArgsValue(new Date(n),function(n){return n.setDate(n.getDate()+t)})},f.dateAddHours=function(n,t){return f.fnArgsValue(new Date(n),function(n){return n.setHours(n.getHours()+t)})},f.dateAddMinutes=function(n,t){return f.fnArgsValue(new Date(n),function(n){return n.setMinutes(n.getMinutes()+t)})},f.dateAddSeconds=function(n,t){return f.fnArgsValue(new Date(n),function(n){return n.setSeconds(n.getSeconds()+t)})},f.dateToXsd=function(n){return f.fmtDate(n,f.fmtDate.DATE_XSD)},Date.begin=function(){var n=Date.now;return n.setTime(0),n},f.mathSqrDiff=function(n,t){return(n-=t)*n},f.mathSqrtSum=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return Math.pow(f.sum(t),.5)},f.mathDistanceEuclidean=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];var e=f.toInt(t.length/2),u=f.range(e,0).map(function(n,r){return f.mathSqrDiff(t[r],t[r+e])});return f.mathSqrtSum.apply(f,_toConsumableArray(u))},f.mathDistanceManhattan=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];var e=f.toInt(t.length/2),u=f.range(e,0).map(function(n,r){return Math.abs(t[r]-t[r+e])});return f.sum(u)},f.mathDistanceDiagonal=function(){for(var n,t=arguments.length,r=Array(t),e=0;t>e;e++)r[e]=arguments[e];var u=f.toInt(r.length/2),o=f.range(u,0).map(function(n,t){return Math.abs(r[t]-r[t+u])});return(n=Math).max.apply(n,_toConsumableArray(o))},f.mathPointId=function(n,t,r){return t*r+n},f.mathTransPoint=function(n,t,r,e){return{x:n+Math.cos(r)*e,y:t+Math.sin(r)*e}};var y=[{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1},{x:1,y:-1}];f.pathfinderAStar=function(n,t,r,e,u,o,i,a){o=o||function(n,r){return f.mathDistanceManhattan(n-t.x,r-t.y)*l},i=i||r*e;var c,s=1,l=f.mathDistanceManhattan(n.x-t.x,n.y-t.y)+1,g={},m={},h={},d=function(n,t,r,e,i,a){var c=u(t,r),s=o(t,r),l=c+i,g=a+1;return{id:n||f.mathPointId(t,r),x:t,y:r,p:e,w:c,h:s,g:l,m:g,f:s+l}},p=function(n,t){return n.f<=t.f?n:t},v=function(n){s++,g[n.id]=h[n.id]=n,a&&a(n.x,n.y)},A=function(n){return d(0,c.x+n.x,c.y+n.y,c.id,c.g,c.m)},b=function(n){return n.x>=0&&n.x<r&&n.y>=0&&n.y<e&&n.w!=Number.MAX_VALUE&&!g[n.id]},O=[];for(n=d(f.mathPointId(n.x,n.y),n.x,n.y,-1,0,0),t=d(f.mathPointId(t.x,t.y),t.x,t.y,-1,0,0),g[n.id]=h[n.id]=n;s++<i&&Object.keys(h).length&&(c=f.takeReduce(h,p).value).id!=t.id;)m[c.id]=c,y.map(A).filter(b).forEach(v);if(c.id==t.id)do O.unshift({x:c.x,y:c.y,dx:t.x-c.x,dy:t.y-c.y}),t=c,c=m[c.p];while(-1!=c.p);return O};var h="eventListeners";f.eventOn=function(n,t,e){var u=r(n,h);return u[t]||(u[t]=[]),u[t].push({callback:e}),f},f.eventOnce=function(n,t,e){var u=r(n,h);return u[t]||(u[t]=[]),u[t].push({callback:e,once:1}),f},f.eventUn=function(n,t){for(var e=arguments.length,u=Array(e>2?e-2:0),o=2;e>o;o++)u[o-2]=arguments[o];var i=r(n,h);return i[t]&&(u.length?u.forEach(function(n){var r=i[t].indexOf(n);~r||i[t].splice(r,1)}):delete i[t]),f},f.eventGo=function(n,t){for(var e=arguments.length,u=Array(e>2?e-2:0),o=2;e>o;o++)u[o-2]=arguments[o];var i=r(n,h);return i[t]&&i[t].slice().forEach(function(n,r){n.callback.apply(n,u),n.once&&i[t].splice(r,1)}),f},f.pool=function(n,t,r){return new Promise(function(e,u){try{var o,i,a,c=function(){if(o=f.values(n),0===o.length)return{v:e([])};i=[];var u=function c(n){a.pop(),i.push(n),o.length>0?(a.unshift(o.shift()),t(a[0],c)):0==a.length&&e(i)};a=o.splice(0,r||o.length),a.forEach(function(n){return t(n,u)})}();if("object"===("undefined"==typeof c?"undefined":_typeof(c)))return c.v}catch(s){u(s)}})};var d="taskList";f.taskPush=function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),u=2;r>u;u++)e[u-2]=arguments[u];1==e.length&&f.isArray(e[0])&&(e=e[0]);var o=a(n,t);return o.push.apply(o,_toConsumableArray(e)),f},f.taskDelete=function(n,t){for(var r=arguments.length,e=Array(r>2?r-2:0),u=2;r>u;u++)e[u-2]=arguments[u];1==e.length&&f.isArray(e)&&(e=e[0]);var o=a(n,t);return e.forEach(function(n,t){~(t=o.indexOf(n))&&o.splice(t,1)}),f},f.taskClear=function(n,t){var r=a(n,t);return r.splice(0),f},f.taskWait=function(n,r,e){for(var u=arguments.length,o=Array(u>3?u-3:0),i=3;u>i;i++)o[i-3]=arguments[i];return new Promise(function(u,i){var c=a(n,r),s=function(n,r){return n.apply(t,o.concat([r]))};f.pool(c,s,e).then(u)["catch"](i)})};var p="historyList";f.historyMaxSize=100,f.historyDo=function(n,t){var e=r(n,p).undo=r(n,p).undo||[];r(n,p).redo=[],e.length>f.historyMaxSize&&e.shift(),e.push(t)},f.historyHasUndo=function(n){return!!(r(n,p).undo=r(n,p).undo||[]).length},f.historyUndo=function(n){var t=r(n,p).undo=r(n,p).undo||[],e=r(n,p).redo=r(n,p).redo||[],u=t.pop();return u&&e.push(u),u},f.historyHasRedo=function(n){return!!(r(n,p).redo=r(n,p).redo||[]).length},f.historyRedo=function(n){var t=r(n,p).undo=r(n,p).undo||[],e=r(n,p).redo=r(n,p).redo||[],u=e.pop();return u&&t.push(u),u},f.historyClear=function(n){r(n,p).undo=[],r(n,p).redo=[]},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=f:n._=f}(isNode?global:window);
